# Tracing
A middleware to track requests using opentracing as a wrapper over jeager.

## Usage
1. Set the env variables, make sure to update the `JAEGER_AGENT_HOST` & `JAEGER_AGENT_PORT` depending on your env.
   ```shell
    JAEGER_AGENT_HOST=localhost;JAEGER_SAMPLER_TYPE=const;JAEGER_SAMPLER_PARAM=1;JAEGER_REPORTER_LOG_SPANS=true;JAEGER_AGENT_PORT=6831
   ```
2. Initiate the tracer & its middleware
    ```go
      tracer, closer := tracing.Init("your-service-name")
      defer closer.Close()
      opentracing.SetGlobalTracer(tracer.Tracer)
         tracerMiddleware := tracing.Tracer(tracer.Tracer, tracing.Config{
                ServiceName:    tracer.Config.ServiceName,
          ServiceVersion: "1.0.0",
         })
    ```
3. Use the middleware over your router
   1. for chi
      ```go
        r := chi.NewRouter()
        r.Use(tracerMiddleware)
        ```
   2. for mux 
      ```go
        mux := http.NewServeMux()
        middleware := tracerMiddleware(mux)
        ```
   3. for gin
      ```go
        engine := gin.New()
        engine.Use(tracerMiddleware)
        ```




   

#### Notes
To add tracing to the clients used by your service, the clients generated by open-api provide the below func and all you need to do is pass the **tracing.HeaderInjector** method to it.
```go
 client, err := policies_service_client.NewClientWithResponses(dsn, policies_service_client.WithRequestEditorFn(tracing.HeaderInjector))
```



### [More](https://www.notion.so/magalix/Using-distributed-tracing-with-your-service-6267e93914cf4a2b908079a4d2bef921)